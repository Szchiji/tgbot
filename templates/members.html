<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>会员管理</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        :root { --sidebar-width: 240px; --primary: #0d6efd; }
        body { background: #f4f7f9; display: flex; min-height: 100vh; }
        .sidebar { width: var(--sidebar-width); background: #fff; border-right: 1px solid #eee; position: fixed; height: 100vh; }
        .nav-link { padding: 12px 25px; color: #555; text-decoration: none; display: block; }
        .nav-link.active { background: #eef7ff; color: var(--primary); border-left: 4px solid var(--primary); }
        .main-content { margin-left: var(--sidebar-width); flex: 1; padding: 30px; }
        .card { border: none; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="p-4 fw-bold text-primary border-bottom">BOT 管理后台</div>
        <div class="mt-3">
            <a href="/stats" class="nav-link"><i class="bi bi-graph-up me-2"></i>消息统计</a>
            <a href="/members" class="nav-link active"><i class="bi bi-people me-2"></i>会员管理</a>
            <a href="/settings" class="nav-link"><i class="bi bi-gear me-2"></i>机器人设置</a>
        </div>
    </div>
    <div class="main-content">
        <div class="d-flex justify-content-between mb-4">
            <h4>会员管理</h4>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMemberModal">+ 新增会员</button>
        </div>
        <div class="card mb-4">
            <div class="card-body">
                <form action="/members" method="get" class="d-flex gap-2">
                    <input type="text" name="q" class="form-control" placeholder="搜索艺名或ID..." value="{{ search_q }}">
                    <button type="submit" class="btn btn-outline-primary">搜索</button>
                </form>
            </div>
        </div>
        <div class="card overflow-hidden">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light"><tr><th class="ps-4">艺名/ID</th><th>地区</th><th>到期日期</th><th>操作</th></tr></thead>
                <tbody>
                    {% for m in members %}
                    <tr>
                        <td class="ps-4"><b>{{ m.stage_name }}</b><br><small class="text-muted">ID: {{ m.user_id }}</small></td>
                        <td>{{ m.area }}</td>
                        <td>{{ m.expire_date }} {% if m.is_expired %}<span class="badge bg-danger">已过期</span>{% endif %}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary me-2" onclick="editMember('{{m.user_id}}','{{m.stage_name}}','{{m.area}}','{{m.expire_date}}','{{m.note}}')">编辑</button>
                            <a href="/members/delete/{{ m.user_id }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('确定删除？')">删除</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="modal fade" id="addMemberModal" tabindex="-1">
        <div class="modal-dialog">
            <form class="modal-content" action="/members/save" method="post">
                <div class="modal-header"><h5>新增/编辑会员</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <div class="mb-3"><label class="form-label">TG ID</label><input type="number" name="user_id" class="form-control" required></div>
                    <div class="mb-3"><label class="form-label">艺名</label><input type="text" name="stage_name" class="form-control" required></div>
                    <div class="mb-3"><label class="form-label">地区</label><input type="text" name="area" class="form-control"></div>
                    <div class="mb-3"><label class="form-label">到期日期</label><input type="date" name="expire_date" class="form-control" required></div>
                    <div class="mb-3"><label class="form-label">备注</label><textarea name="note" class="form-control"></textarea></div>
                </div>
                <div class="modal-footer"><button type="submit" class="btn btn-primary">保存入库</button></div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function editMember(id, name, area, expire, note) {
            const modal = document.getElementById('addMemberModal');
            const form = modal.querySelector('form');
            form.querySelector('input[name="user_id"]').value = id;
            form.querySelector('input[name="user_id"]').readOnly = true;
            form.querySelector('input[name="stage_name"]').value = name;
            form.querySelector('input[name="area"]').value = area;
            form.querySelector('input[name="expire_date"]').value = expire;
            form.querySelector('textarea[name="note"]').value = note;
            new bootstrap.Modal(modal).show();
        }
    </script>
</body>
</html>
